<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://unpkg.com/face-api.js"></script> 
    <style>
        /* CSS styles (omitted for brevity) */
    </style>
</head>
<body>
    <h1>Face Recognition</h1>
    <p id="status">Loading models...</p>

    <div id="input-container">
        <input type="file" id="imageInput" accept="image/*">
        <p>Upload an image to test the model</p>
        <img id="preview" src="" alt="Image Preview">
    </div>

    <div id="result">
        <h2>Prediction:</h2>
        <p id="prediction" class="loading">No prediction yet</p>
    </div>

    <canvas id="overlay"></canvas> 

    <script>
        const modelURL = '/models'; // Path to your face-api.js models
        const knownFaceEmbeddings = [ 
            /* 
               Replace with actual face embeddings for known individuals. 
               Example: 
               [
                   [0.123, 0.456, ...], // Embedding for person 1
                   [0.789, 0.234, ...]  // Embedding for person 2
               ] 
            */
        ];
        const knownPersonNames = ['Person 1', 'Person 2']; // Names corresponding to embeddings

        let faceMatcher; 

        async function loadModels() {
            try {
                await faceapi.loadSsdMobilenetv1Model(modelURL);
                await faceapi.loadFaceLandmarkModel(modelURL);
                await faceapi.loadFaceRecognitionModel(modelURL);
                console.log('Models loaded successfully');
                document.getElementById('status').innerText = 'Models loaded successfully!';

                // Create a FaceMatcher instance
                faceMatcher = new faceapi.FaceMatcher(knownFaceEmbeddings, knownPersonNames, 0.6); 
            } catch (error) {
                console.error('Error loading models:', error);
                document.getElementById('status').innerText = 'Failed to load models. Check model URLs.';
            }
        }

        loadModel();

        document.getElementById('imageInput').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const preview = document.getElementById('preview');
            preview.src = URL.createObjectURL(file);

            preview.onload = async () => { 
                const canvas = document.getElementById('overlay');
                faceapi.matchDimensions(canvas, preview); 

                try {
                    const detections = await faceapi.detectAllFaces(preview)
                        .withFaceLandmarks()
                        .withFaceDescriptors();

                    if (detections.length > 0) {
                        const results = await faceapi.matchDistances(detections);
                        const displayResults = results.map((result, i) => {
                            const bestMatch = result[0];
                            return `Face ${i + 1}: ${bestMatch.label} (distance: ${bestMatch.distance})`;
                        });
                        document.getElementById('prediction').innerText = displayResults.join('<br>'); 
                    } else {
                        document.getElementById('prediction').innerText = 'No faces detected.';
                    }

                    faceapi.draw.drawDetections(canvas, detections); 
                    faceapi.draw.drawFaceLandmarks(canvas, detections); 

                } catch (error) {
                    console.error('Error during prediction:', error);
                    document.getElementById('prediction').innerText = `Prediction failed: ${error.message}`; 
                }
            };
        });
    </script>
</body>
</html>
